function doGet(e) { 
  const numeroAuto = e.parameter.numeroAuto;
  const hojaExistente = verificarSiExisteHoja(numeroAuto);

  // Agregar encabezado CORS
  return ContentService.createTextOutput(
    JSON.stringify({ exists: hojaExistente }),
    ContentService.MimeType.JSON
  ).setMimeType(ContentService.MimeType.JSON)
   .setHeaders({ 'Access-Control-Allow-Origin': '*' });
}

function doPost(e) {
  const datos = JSON.parse(e.postData.contents);
  const nombreEquipo = datos.nombreEquipo;
  const nombreResponsable = datos.nombreResponsable;
  const numeroAuto = datos.numeroAuto;
  const miembros = datos.miembros;

  // Verificar si ya existe la hoja
  const hojaExistente = verificarSiExisteHoja(numeroAuto);

  if (hojaExistente) {
    return ContentService.createTextOutput(
      JSON.stringify({ result: 'error', error: 'El número de auto ya está registrado.' }),
      ContentService.MimeType.JSON
    ).setHeaders({ 'Access-Control-Allow-Origin': '*' });
  }

  // Crear nueva hoja para el equipo
  const hoja = crearHoja(numeroAuto);
  
  // Agregar encabezados
  hoja.appendRow(['Rol', 'Nombre', 'Apellido Paterno', 'Apellido Materno', 'No. Hard Card', 'Correo Electrónico']);
  
  // Agregar los miembros del equipo
  miembros.forEach(miembro => {
    hoja.appendRow([miembro.rol, miembro.nombre, miembro.apellidoPaterno, miembro.apellidoMaterno, miembro.noHardCard, miembro.email]);
  });

  return ContentService.createTextOutput(
    JSON.stringify({ result: 'success' }),
    ContentService.MimeType.JSON
  ).setHeaders({ 'Access-Control-Allow-Origin': '*' });
}

// Función para verificar si existe una hoja con el número de auto
function verificarSiExisteHoja(numeroAuto) {
  const libro = SpreadsheetApp.getActiveSpreadsheet();
  const hojas = libro.getSheets();
  for (let i = 0; i < hojas.length; i++) {
    if (hojas[i].getName() === numeroAuto) {
      return true;
    }
  }
  return false;
}

// Función para crear una nueva hoja con el número de auto
function crearHoja(numeroAuto) {
  const libro = SpreadsheetApp.getActiveSpreadsheet();
  const hoja = libro.insertSheet(numeroAuto); // Esto crea una hoja con el nombre del número de auto
  return hoja;
}
