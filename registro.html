<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Miembros del Equipo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background-color: #f9f9f9;
    }

    h2 {
      color: #333;
    }

    .warning {
      color: red;
      margin-top: 10px;
      display: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
    }

    input {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }

    input.invalid {
      border: 2px solid red;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #007BFF;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .notice {
      font-size: 14px;
      color: gray;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h2 id="bienvenida">Bienvenido Equipo</h2>
  <p>Registro de Miembros del Equipo. Por favor, llena todos los campos. Los nombres y apellidos deben coincidir con la identificación oficial.</p>

  <div class="warning" id="advertenciaCampos">⚠️ Por favor, completa todos los campos.</div>

  <form id="formRegistro">
    <table>
      <thead>
        <tr>
          <th>Rol</th>
          <th>Nombre</th>
          <th>Apellido Paterno</th>
          <th>Apellido Materno</th>
          <th>No. Hard Card</th>
          <th>Correo Electrónico</th>
        </tr>
      </thead>
      <tbody id="tablaCuerpo">
        <!-- Aquí se crearán las filas dinámicamente -->
      </tbody>
    </table>

    <button type="button" onclick="validarYEnviar()">Enviar Información</button>
  </form>

  <script>
    const roles = [
      "Piloto", "Copiloto", "Jefe de Equipo", "Mecánico 1", "Mecánico 2", "Ingeniero", "Logística", "Prensa", "Invitado 1", "Invitado 2", "Otro 1", "Otro 2"
    ];

    const nombreEquipo = localStorage.getItem("nombreEquipo");
    const nombreResponsable = localStorage.getItem("nombreResponsable");
    const numeroAuto = localStorage.getItem("numeroAuto");

    document.getElementById("bienvenida").textContent = `Equipo: ${nombreEquipo} - Responsable: ${nombreResponsable} - Auto: ${numeroAuto}`;

    const tablaCuerpo = document.getElementById("tablaCuerpo");

    // Crear las filas de la tabla dinámicamente
    roles.forEach(rol => {
      const fila = document.createElement("tr");

      const celdaRol = document.createElement("td");
      celdaRol.textContent = rol;
      fila.appendChild(celdaRol);

      for (let i = 0; i < 5; i++) {
        const celda = document.createElement("td");
        const input = document.createElement("input");
        input.type = "text";
        input.name = `${rol.replace(" ", "_")}_${i}`; // Asignar nombre para identificar los campos
        celda.appendChild(input);
        fila.appendChild(celda);
      }

      tablaCuerpo.appendChild(fila);
    });

    function validarYEnviar() {
      const inputs = document.querySelectorAll("input");
      let algunoVacio = false;

      inputs.forEach((input) => {
        if (!input.value.trim()) {
          input.classList.add("invalid");
          algunoVacio = true;
        } else {
          input.classList.remove("invalid");
        }
      });

      if (algunoVacio) {
        alert("⚠️ Por favor, completa todos los campos.");
      } else {
        enviarFormulario();
      }
    }

    function enviarFormulario() {
      const inputs = document.querySelectorAll("input");
      const miembros = [];

      roles.forEach(rol => {
        const camposRol = [];
        for (let i = 0; i < 5; i++) {
          const input = document.querySelector(`input[name="${rol.replace(" ", "_")}_${i}"]`);
          camposRol.push(input.value.trim());
        }
        miembros.push({
          rol: rol,
          nombre: camposRol[0],
          apellidoPaterno: camposRol[1],
          apellidoMaterno: camposRol[2],
          noHardCard: camposRol[3],
          email: camposRol[4],
        });
      });

      const datos = {
        nombreEquipo,
        nombreResponsable,
        numeroAuto,
        miembros,
      };

      fetch("TU_URL_DEL_SCRIPT", {  // Reemplaza con la URL de tu Google Apps Script
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos),
      })
      .then(response => response.json())
      .then(data => {
        if (data.result === "success") {
          localStorage.removeItem("nombreEquipo");
          localStorage.removeItem("nombreResponsable");
          localStorage.removeItem("numeroAuto");
          window.location.href = "confirmacion.html"; // Redirige a la confirmación
        } else {
          alert(`⚠️ Error: ${data.error}`);
        }
      })
      .catch(error => alert("⚠️ Error al enviar los datos."));
    }
  </script>

</body>
</html>
