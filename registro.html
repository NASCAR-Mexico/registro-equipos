<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Miembros del Equipo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background-color: #f9f9f9;
    }

    header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    header img {
      width: 80px;
      height: auto;
      margin-right: 20px;
    }

    h2 {
      color: #333;
      margin: 0;
    }

    .warning {
      color: red;
      margin-top: 10px;
      display: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
    }

    input {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }

    input.invalid {
      border: 2px solid red;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #007BFF;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .confirm-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .confirm-dialog {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .confirm-buttons button {
      margin: 0 10px;
    }
  </style>
</head>
<body>

  <header>
    <img src="logo.PNG" alt="Logotipo Empresa">
    <h2 id="bienvenida">Bienvenido Equipo</h2>
  </header>

  <p>Registro de Miembros del Equipo. Por favor, llena todos los campos.</p>
  <div class="warning" id="advertenciaCampos">⚠️ Por favor, completa todos los campos.</div>

  <form id="formRegistro">
    <table>
      <thead>
        <tr>
          <th>Rol</th>
          <th>Nombre</th>
          <th>Apellido Paterno</th>
          <th>Apellido Materno</th>
          <th>No. Hard Card</th>
          <th>Correo Electrónico</th>
        </tr>
      </thead>
      <tbody id="tablaCuerpo"></tbody>
    </table>

    <button type="button" onclick="validarYEnviar()">Enviar Información</button>
  </form>

  <div class="confirm-overlay" id="confirmOverlay">
    <div class="confirm-dialog">
      <p>Estás a punto de enviar el formulario sin todos los datos completos. ¿Continuar?</p>
      <div class="confirm-buttons">
        <button onclick="enviarFormulario()">Continuar</button>
        <button onclick="cancelarEnvio()">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    const roles = [
      "Piloto", "Copiloto", "Jefe de Equipo", "Mecánico 1", "Mecánico 2",
      "Ingeniero", "Logística", "Prensa", "Invitado 1", "Invitado 2",
      "Otro 1", "Otro 2"
    ];

    const nombreEquipo = localStorage.getItem("nombreEquipo") || "Sin nombre";
    const nombreResponsable = localStorage.getItem("nombreResponsable") || "Sin responsable";
    const numeroAuto = localStorage.getItem("numeroAuto") || "Sin número";

    document.getElementById("bienvenida").textContent =
      `Equipo: ${nombreEquipo} - Responsable: ${nombreResponsable} - Auto: ${numeroAuto}`;

    const tablaCuerpo = document.getElementById("tablaCuerpo");

    function crearFilasTabla() {
      roles.forEach((rol) => {
        const fila = document.createElement("tr");

        const celdaRol = document.createElement("td");
        celdaRol.textContent = rol;
        fila.appendChild(celdaRol);

        for (let i = 0; i < 5; i++) {
          const celda = document.createElement("td");
          const input = document.createElement("input");
          input.type = "text";
          input.name = `${rol.replace(/ /g, "_")}_${i}`;
          celda.appendChild(input);
          fila.appendChild(celda);
        }

        tablaCuerpo.appendChild(fila);
      });
    }

    crearFilasTabla();

    function validarYEnviar() {
      const inputs = document.querySelectorAll("input");
      let algunoVacio = false;

      inputs.forEach((input) => {
        if (!input.value.trim()) {
          input.classList.add("invalid");
          algunoVacio = true;
        } else {
          input.classList.remove("invalid");
        }
      });

      if (algunoVacio) {
        document.getElementById("confirmOverlay").style.display = "flex";
      } else {
        enviarFormulario();
      }
    }

    function cancelarEnvio() {
      document.getElementById("confirmOverlay").style.display = "none";
    }

    function enviarFormulario() {
      document.getElementById("confirmOverlay").style.display = "none";
      const miembros = [];

      roles.forEach((rol) => {
        const campos = [];
        for (let i = 0; i < 5; i++) {
          const input = document.querySelector(`input[name="${rol.replace(/ /g, "_")}_${i}"]`);
          campos.push(input.value.trim());
        }
        miembros.push({
          rol: rol,
          nombre: campos[0],
          apellidoPaterno: campos[1],
          apellidoMaterno: campos[2],
          noHardCard: campos[3],
          email: campos[4],
        });
      });

      const datos = {
        nombreEquipo,
        nombreResponsable,
        numeroAuto,
        miembros
      };

      console.log("Enviando:", datos);

      fetch("https://script.google.com/macros/s/AKfycbwpH0giGdSCT53sw0pmdEGxmkehAnEkyh1hS-tTzvhkjxij2xtsGLZAJYwgNNJPl8TQ/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(datos)
      })
      .then((res) => res.json())
      .then((data) => {
        if (data.result === "success") {
          localStorage.clear();
          window.location.href = "confirmacion.html";
        } else {
          alert("Error del servidor: " + data.error);
        }
      })
      .catch((err) => {
        console.error(err);
        alert("Error al enviar los datos.");
      });
    }
  </script>

</body>
</html>
