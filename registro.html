<!DOCTYPE html>
 <html lang="es">
 <head>
  <meta charset="UTF-8">
  <title>Registro de Miembros del Equipo</title>
  <style>
  body {
  font-family: Arial, sans-serif;
  padding: 30px;
  background-color: #f9f9f9;
  }

  h2 {
  color: #333;
  }

  .warning {
  color: red;
  margin-top: 10px;
  display: none;
  }

  table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  }

  th,
  td {
  padding: 8px;
  border: 1px solid #ddd;
  }

  input {
  width: 100%;
  padding: 5px;
  box-sizing: border-box;
  }

  input.invalid {
  border: 2px solid red;
  }

  button {
  margin-top: 20px;
  padding: 10px 20px;
  background-color: #007BFF;
  color: white;
  font-size: 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  }

  button:hover {
  background-color: #0056b3;
  }

  .notice {
  font-size: 14px;
  color: gray;
  margin-top: 10px;
  }

  /* Estilos para el cuadro de diálogo de confirmación */
  .confirm-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
  z-index: 1000;
  }

  .confirm-dialog {
  background-color: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  text-align: center;
  }

  .confirm-buttons {
  margin-top: 20px;
  }

  .confirm-buttons button {
  margin: 0 10px;
  padding: 10px 15px;
  cursor: pointer;
  }
  </style>
 </head>
 <body>

  <h2 id="bienvenida">Bienvenido Equipo</h2>
  <p>Registro de Miembros del Equipo. Deberás llenar todos los espacios. El nombre y apellido deben aparecer igual que en la identificación oficial, ya que se deberá presentar para recibir el pase correspondiente. El correo electrónico puede ser el mismo para todos los integrantes o el personal.</p>

  <div class="warning" id="advertenciaCampos">⚠️ Los campos vacíos no podrán llenarse de nuevo.</div>
  <div class="notice">Al presionar ENVIAR, aceptas que la información capturada es correcta.</div>

  <form id="formRegistro">
  <table>
  <thead>
  <tr>
  <th>Rol</th>
  <th>Nombre</th>
  <th>Apellido Paterno</th>
  <th>Apellido Materno</th>
  <th>No. Hard Card</th>
  <th>Correo Electrónico</th>
  </tr>
  </thead>
  <tbody id="tablaCuerpo">
  </tbody>
  </table>

  <button type="button" onclick="validarYEnviar()">ENVIAR INFORMACIÓN</button>
  </form>

  <div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-dialog">
  <p>Estás a punto de enviar el formulario sin todos los datos completos. ¿Continuar?</p>
  <div class="confirm-buttons">
  <button type="button" onclick="enviarDatosAlServidor()">Continuar</button>
  <button type="button" onclick="cancelarEnvio()">Cancelar</button>
  </div>
  </div>
  </div>

  <script>
  const roles = [
  "Piloto",
  "Propietario",
  "Jefe de Equipo",
  "Mecánico 1",
  "Mecánico 2",
  "Mecánico 3",
  "Operador 1",
  "Operador 2",
  "Invitado 1",
  "Invitado 2",
  "Menor 1",
  "Menor 2",
  ];

  const nombreEquipo = localStorage.getItem("nombreEquipo") || "Sin nombre";
  document.getElementById("bienvenida").innerText = "Bienvenido Equipo " + nombreEquipo;

  const tabla = document.getElementById("tablaCuerpo");
  const confirmOverlay = document.getElementById("confirmOverlay"); // Mantener la referencia

  // Crear filas dinámicamente
  roles.forEach((rol, i) => {
  const fila = document.createElement("tr");

  const tdRol = document.createElement("td");
  tdRol.textContent = rol;
  fila.appendChild(tdRol);

  for (let j = 0; j < 5; j++) {
  const td = document.createElement("td");
  const input = document.createElement("input");
  input.name = `<span class="math-inline">\{rol\}\_campo</span>{j}`;
  td.appendChild(input);
  fila.appendChild(td);
  }

  tabla.appendChild(fila);
  });

  function validarYEnviar() {
  const inputs = document.querySelectorAll("input");
  let algunoVacio = false;

  inputs.forEach((input) => {
  if (input.value.trim() === "") {
  input.classList.add("invalid");
  algunoVacio = true;
  } else {
  input.classList.remove("invalid");
  }
  });

  if (algunoVacio) {
  document.getElementById("advertenciaCampos").style.display = "block";
  // Si quieres usar el diálogo de confirmación, llama a mostrarConfirmacion() aquí
  // mostrarConfirmacion();
  } else {
  enviarDatosAlServidor(); // Llama directamente a la función de envío
  }
  }

  function mostrarConfirmacion() {
  confirmOverlay.style.display = "flex";
  }

  function cancelarEnvio() {
  confirmOverlay.style.display = "none";
  }

  function confirmarEnvio() {
  confirmOverlay.style.display = "none";
  enviarDatosAlServidor();
  }

  function enviarDatosAlServidor() {
  const inputs = document.querySelectorAll("input");
  const miembros = [];

  for (let i = 0; i < roles.length; i++) {
  const base = i * 5;
  miembros.push({
  rol: roles[i],
  nombre: inputs[base].value,
  apellidoP: inputs[base + 1].value,
  apellidoM: inputs[base + 2].value,
  hardCard: inputs[base + 3].value,
  email: inputs[base + 4].value,
  });
  }

  const datos = {
  nombreEquipo: nombreEquipo,
  miembros: miembros,
  };

  fetch(
  "https://script.google.com/macros/s/AKfycbwWVn9K6plT6XX5K4mE_aJHom6CXyk_aZXSkyX54425nrs1hRPnafZKLrUssc9DqbV4/exec",
  {
  method: "POST",
  body: JSON.stringify(datos),
  headers: {
  "Content-Type": "application/json",
  },
  }
  )
  .then((res) => res.text())
  .then((msg) => {
  localStorage.clear();
  window.location.href = "confirmacion.html";
  })
  .catch((err) => {
  console.error("Error al enviar:", err);
  alert("Hubo un error al enviar los datos.");
  });
  }
  </script>
 </body>
 </html>
